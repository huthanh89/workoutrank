#-------------------------------------------------------------------------------
# Imports
#-------------------------------------------------------------------------------

_       = require 'lodash'
express = require 'express'
Account = require './account/module'
router  = express.Router()

#-------------------------------------------------------------------------------
# Router Level Middleware
#-------------------------------------------------------------------------------

router.use (req, res, next) ->

  if _.isUndefined(req.session.user)
    res.status 401
    res.end()

  else if req.session.user.username not in ['tth', 'admin']
    res.status 401
    res.redirect '/login'

  else
    next()

  return

#-------------------------------------------------------------------------------
# Serve Index.html
#-------------------------------------------------------------------------------

index = (req, res, next) ->
  res.render 'index'
  return

router.get 'accounts', index

#-------------------------------------------------------------------------------
# API Resources.
#-------------------------------------------------------------------------------

router.get '/api/accounts', Account.get

#-------------------------------------------------------------------------------
# Exports
#-------------------------------------------------------------------------------

module.exports = router

#-------------------------------------------------------------------------------